(env (dev (flags (-w -33) ) ) )

#ifdef API
(executable
  (package geneweb-bin)
  (name marshal_dico_place)
  (public_name marshal_dico_place)
  (libraries unix %%%GWDB_PKG%%% %%%SOSA_PKG%%% %%%WSERVER_PKG%%% geneweb)
  (modules marshal_dico_place)
)
#else
(dirs :standard \ dico_place)
#endif

#ifdef GENEWEB_GWDB_LEGACY
(executable
  (package geneweb-bin)
  (public_name gwgc)
  (modules gwgc)
  (preprocess (action (run %{bin:cppo} %%%CPPO_D%%% %{input-file})))
  (libraries unix str %%%GWDB_PKG%%% %%%SOSA_PKG%%% %%%WSERVER_PKG%%% geneweb)
)
#else
(dirs :dirs \ gwgc)
#endif

(executable
  (package geneweb-bin)
  (public_name consang)
  (modules consang)
  (preprocess (action (run %{bin:cppo} %%%CPPO_D%%% %{input-file})))
  (libraries unix %%%GWDB_PKG%%% %%%SOSA_PKG%%% %%%WSERVER_PKG%%% geneweb)
)

(executable
  (package geneweb-bin)
  (public_name gwc)
  (modules gwc db1link)
  (preprocess (action (run %{bin:cppo} %%%CPPO_D%%% %{input-file})))
  (libraries unix %%%GWDB_PKG%%% %%%SOSA_PKG%%% %%%WSERVER_PKG%%% geneweb)
)

(executable
  (package geneweb-bin)
  (public_name ged2gwb)
  (modules ged2gwb)
  (libraries unix str camlp5.gramlib %%%GWDB_PKG%%% %%%SOSA_PKG%%% %%%WSERVER_PKG%%% geneweb)
)

(executable
  (package geneweb-bin)
  (public_name gwfixbase)
  (modules gwfixbase)
  (libraries unix str %%%GWDB_PKG%%% %%%SOSA_PKG%%% %%%WSERVER_PKG%%% geneweb-lib)
)

(include_subdirs unqualified)

(library
  (name gwexport)
  (public_name geneweb-gwexport-lib)
  (libraries geneweb %%%GWDB_PKG%%% %%%SOSA_PKG%%% %%%WSERVER_PKG%%%)
  (preprocess (action (run %{bin:cppo} %%%CPPO_D%%% %{input-file})))
  (modules gwexport)
)

(library
  (name gwulib)
  (public_name geneweb-gwu-lib)
  (wrapped false)
  (libraries geneweb gwexport %%%GWDB_PKG%%% %%%SOSA_PKG%%% %%%WSERVER_PKG%%%)
  (preprocess (action (run %{bin:cppo} %%%CPPO_D%%% %{input-file})))
  (modules gwuLib)
)

(executables
  (package geneweb-bin)
  (public_names gwu)
  (modules gwu)
  (libraries geneweb gwexport gwulib str unix %%%GWDB_PKG%%% %%%SOSA_PKG%%% %%%WSERVER_PKG%%%)
)

(library
  (name gwb2gedlib)
  (public_name geneweb-gwb2ged-lib)
  (wrapped false)
  (libraries geneweb gwexport %%%GWDB_PKG%%% %%%SOSA_PKG%%% %%%WSERVER_PKG%%%)
  (preprocess (action (run %{bin:cppo} %%%CPPO_D%%% %{input-file})))
  (modules gwb2gedLib)
)

(executables
  (package geneweb-bin)
  (public_names gwb2ged)
  (modules gwb2ged)
  (libraries geneweb geneweb-gwb2ged-lib geneweb-gwu-lib str unix %%%GWDB_PKG%%% %%%SOSA_PKG%%% %%%WSERVER_PKG%%%)
)

(rule
  (target plugins_md5.ml)
  (deps
    %{project_root}/plugins/export/plugin_export.cmxs
    %{project_root}/plugins/fanchart/plugin_fanchart.cmxs
    %{project_root}/plugins/gwxjg/plugin_gwxjg.cmxs
    %{project_root}/plugins/jingoo/plugin_jingoo.cmxs
    %{project_root}/plugins/re/plugin_re.cmxs
    %{project_root}/plugins/v8/plugin_v8.cmxs
  )
  (action (with-stdout-to %{target} (run ocaml ./mk_plugins_md5.ml %{deps})))
)

(library
  (name gwdpluginlib)
  (wrapped false)
  (libraries geneweb-lib %%%GWDB_PKG%%% %%%SOSA_PKG%%% %%%WSERVER_PKG%%%)
  (modules gwdPlugin)
)

(executable
  (package geneweb-bin)
  (public_name gwd)
  (flags -linkall)
  (libraries dynlink geneweb-lib gwdpluginlib unix str %%%GWDB_PKG%%% %%%SOSA_PKG%%% %%%WSERVER_PKG%%%)
  (preprocess (action (run %{bin:cppo} %%%CPPO_D%%% %{input-file})))
  (modules dep gwd gwDaemon plugins_md5 request requestHandler)
)

(executables
  (package geneweb-bin)
  (public_names connex gwdiff setup update_nldb)
  (modules connex gwdiff setup update_nldb)
  (libraries unix str %%%GWDB_PKG%%% %%%SOSA_PKG%%% %%%WSERVER_PKG%%% geneweb)
)
